#!/usr/bin/env node

var path = require('path');
var fs = require('fs');
var millstone = require('millstone');

var args = process.argv.slice(1);

if (!args[1]) {
   console.log('millstone: please provide a path to an mml file');
   process.exit(1);
}
var mml = JSON.parse(fs.readFileSync(args[1]));

var options = {
    mml: mml,
    base: path.dirname(args[1]),
    cache: '/tmp/millstone-test'
};

millstone.resolve(options, function(err, resolved) {
    if (err) throw err;
    console.log(JSON.stringify(resolved,null,4));
    // force exit to avoid wait for generic-pool to empty
    process.exit(0);
});